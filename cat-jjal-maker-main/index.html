<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>고양이 가라사대</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>
  <style>
    body {
      text-align: center;
    }
    .main-card{
        width: 100%;
    }
    .favorites {
      list-style: none;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    .genBtn{
        margin: 10px 0 10px 0;
        padding: 10px;
        width: 180px;
        border-radius: 20px;
        background: aliceblue;
        border: solid 3px black;
        font-size: 16px;
        cursor: pointer;
    }
    .divWrap{
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }
    
    .favoriteWrap{
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }
  </style>
  <body>
    <div id="resultWrap">
    </div>
    <!--스크립트-->
    <!--스타일 라이브러리 나중에 참고하기 이모션, 테일윈드-->
    <script type="text/babel">

        const TitleWrap = (props) => (
            <h1>{props.children}</h1>
        );

        const FormWrap = (props) => { 
            return (
                <button type="button" className="genBtn" onClick={props.handleGenBtnClick}>생성</button>
        )};

        const MainCardWrap = (props) =>  { 
            return (
                <img src={props.imgSrc} style={{width:'400px' , height:'auto' , borderRadius:'30px' , height : '300px'}} />
                
        )};

        const LikeBtnWrap = (props) => {
            return (<button onClick = {props.handleHeartClick}>{props.heartIcon}</button>);
        }

        //파라미터 받아올때 중괄호로 바로 하위요소로도 접근가능
        const CatItem = ({imgSrc}) => (
            <div>
                <img src={imgSrc} style={{width: '150px' , height: '150px' , border : 'solid 2px black' , borderRadius : '20px'}} />
            </div>
        );

        const FavoritesWrap = (props) => { 
            if(props.favoriteCat.length > 0){
                return (
                    <div class="favoriteWrap">
                        {props.favoriteCat.map((cat , i) => <CatItem key={i} imgSrc={cat}/>)}
                    </div>
                )
            }else{
                return (
                    <div>
                        <p>좋아요를 눌러보세요.</p>
                    </div>
                )
            }
        };
        
        const jsonLocalStorage = {
            setItem: (key, value) => {
              localStorage.setItem(key, JSON.stringify(value));
            },
            getItem: (key) => {
              return JSON.parse(localStorage.getItem(key));
            },
        };

        const fnGetRamdomCatImg = async () => {
            let imgSrc = "";
            try {
                const response = await fetch('https://api.thecatapi.com/v1/images/search');
                const data = await response.json();
                imgSrc = data[0].url;
            } catch (error) {
                console.log(error);
            }
            return imgSrc;
        };

        const App = () => { 
            const [cnt , setCnt] = React.useState(Number(localStorage.getItem('cnt')) || 0 );
            const [catImgNo , setCatImgNo] = React.useState(0);
            const catImgArr = ["https://cataas.com/cat/HSENVDU4ZMqy7KQ0/says/react","https://cataas.com/cat/BxqL2EjFmtxDkAm2/says/inflearn","https://cataas.com/cat/18MD6byVC1yKGpXp/says/JavaScript"];
            const [favoriteCat , setFavoriteCat] = React.useState(jsonLocalStorage.getItem('favoriteCats') || []);
            const [val , setVal] = React.useState('');
            const [heartIcon , setHeartStatus] = React.useState("🤍");
            const [errMsg , setErrMsg] = React.useState("");
            const [randomCatImgSrc , setRandomCatImgSrc] = React.useState("");

            React.useEffect(() => {
                const fetchCatImage = async () => {
                    const imgSrc = await fnGetRamdomCatImg();
                    setRandomCatImgSrc(imgSrc);
                };
                fetchCatImage();
            }, []);

            const handleGenBtnClick = (e) => {
                e.preventDefault();
                if(val == '' || errMsg != ''){
                    setErrMsg("정확한 값을 입력해주세요.")
                    //return;
                }
                setCnt(cnt + 1);
                setHeartStatus("🤍");
                jsonLocalStorage.setItem('cnt',cnt + 1);
                setCatImgNo(catImgNo + 1);
                const fetchCatImage = async () => {
                    const imgSrc = await fnGetRamdomCatImg();
                    setRandomCatImgSrc(imgSrc);
                };
                fetchCatImage();
            };
            const handleHeartClick = (imgSrc) => {
                if(favoriteCat.includes(imgSrc)){
                    setHeartStatus("🤍");
                    setFavoriteCat(favoriteCat.filter(cat => cat !== imgSrc));
                    jsonLocalStorage.setItem('favoriteCats',favoriteCat.filter(cat => cat !== imgSrc));
                }else{
                    setHeartStatus("💖");
                    setFavoriteCat([...favoriteCat , imgSrc]);
                    jsonLocalStorage.setItem('favoriteCats',[...favoriteCat , imgSrc]);
                }
            }
            const handleInputChange = (e) => {
                e.preventDefault();
                let inputVal = e.target.value.toUpperCase();
                if (/[\u3131-\uD79D]/.test(inputVal)) {
                    setErrMsg("한글은 입력할 수 없습니다.");
                }else{
                    setErrMsg("");
                }
                setVal(inputVal);
                //console.log(val);
            }

            return (
            <div className="divWrap">
                <TitleWrap>네코네코니 No {cnt}</TitleWrap>
                <FormWrap val={val} handleGenBtnClick={handleGenBtnClick} />
                <MainCardWrap  imgSrc={randomCatImgSrc} />
                <LikeBtnWrap handleHeartClick={() => handleHeartClick(randomCatImgSrc)} heartIcon={heartIcon} />
                <FavoritesWrap favoriteCat={favoriteCat} />
            </div>
        )};

        const render = ReactDOM.createRoot(document.getElementById("resultWrap"))
        render.render(<App />);


    </script>

    </body>
</html>
