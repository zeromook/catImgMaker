<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>고양이 가라사대</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>
  <style>
    body {
      text-align: center;
    }
    .main-card button {
      position: relative;
      left: -45px;
      bottom: 15px;
    }
    .favorites {
      list-style: none;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
    }
  </style>
  <body>
    <div id="resultWrap">
    </div>
    <!--스크립트-->
    <!--스타일 라이브러리 나중에 참고하기 이모션, 테일윈드-->
    <script type="text/babel">

        const TitleWrap = (props) => (
            <h1>{props.children}</h1>
        );

        const FormWrap = (props) => { 
            return (
            <form onSubmit={(e) => {return false;}}>
                <input type="text" placeholder="영어로 입력하세요." value={props.val} onChange={props.handleInputChange} />
                <button type="button" onClick={props.handleGenBtnClick}>생성</button>
                <p style={{color : 'red' , fontWeight : 'bold'}}>{props.errMsg}</p>
            </form>
        )};

        const MainCardWrap = (props) =>  { 
           
            return (
            <div className="main-card">
                <img src={props.imgSrc} style={{width:'450px' , height:'515px' , borderRadius:'30px'}} />
                <button onClick = {props.handleHeartClick}>{props.heartIcon}</button>
            </div>
        )};
        //파라미터 받아올때 중괄호로 바로 하위요소로도 접근가능
        const CatItem = ({imgSrc}) => (
            <li>
                <img src={imgSrc} style={{width: '150px' , height: '150px' , border : 'solid 2px black' , borderRadius : '20px'}} />
            </li>
        );

        const FavoritesWrap = (props) => { 
            return (
            <ul className="favorites">
                {props.favoriteCat.map((cat , i) => <CatItem key={i} imgSrc={cat}/>)}
            </ul>
        )};
        
        const jsonLocalStorage = {
            setItem: (key, value) => {
              localStorage.setItem(key, JSON.stringify(value));
            },
            getItem: (key) => {
              return JSON.parse(localStorage.getItem(key));
            },
        };

        const App = () => { 
            const [cnt , setCnt] = React.useState(Number(localStorage.getItem('cnt')));
            const [catImgNo , setCatImgNo] = React.useState(0);
            const catImgArr = ["https://cataas.com/cat/HSENVDU4ZMqy7KQ0/says/react","https://cataas.com/cat/BxqL2EjFmtxDkAm2/says/inflearn","https://cataas.com/cat/18MD6byVC1yKGpXp/says/JavaScript"];
            const [favoriteCat , setFavoriteCat] = React.useState(jsonLocalStorage.getItem('favoriteCats') || []);
            const [val , setVal] = React.useState('');
            const [heartIcon , setHeartStatus] = React.useState("🤍");
            const [errMsg , setErrMsg] = React.useState("");
            const handleGenBtnClick = (e) => {
                e.preventDefault();
                if(val == '' || errMsg != ''){
                    setErrMsg("정확한 값을 입력해주세요.")
                    return;
                }
                setCnt(cnt + 1);
                setCatImgNo(catImgNo + 1);
                setHeartStatus("🤍");
                jsonLocalStorage.setItem('cnt',cnt + 1);
                if(catImgNo > 1) setCatImgNo(0);
            };
            const handleHeartClick = (imgSrc) => {
                //alert("좋아요 클릭됨");
                setHeartStatus("💖");
                setFavoriteCat([...favoriteCat , imgSrc]);
                jsonLocalStorage.setItem('favoriteCats',[...favoriteCat , imgSrc]);
            }
            const handleInputChange = (e) => {
                e.preventDefault();
                let inputVal = e.target.value.toUpperCase();
                if (/[\u3131-\uD79D]/.test(inputVal)) {
                    setErrMsg("한글은 입력할 수 없습니다.");
                }else{
                    setErrMsg("");
                }
                setVal(inputVal);
                //console.log(val);
            }

            return (
            <div>
                <TitleWrap>네코네코니 No {cnt}</TitleWrap>
                <FormWrap val={val} handleGenBtnClick={handleGenBtnClick} handleInputChange={handleInputChange} errMsg={errMsg}/>
                <MainCardWrap handleHeartClick={() => handleHeartClick(catImgArr[catImgNo])} imgSrc={catImgArr[catImgNo]} heartIcon={heartIcon} />
                <FavoritesWrap favoriteCat={favoriteCat} />
            </div>
        )};

        ReactDOM.render(<App /> , document.querySelector("#resultWrap"));


    </script>

    </body>
</html>
